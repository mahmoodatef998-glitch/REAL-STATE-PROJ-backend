# ๐ ุชุญุฏูุซ ูุธุงู ุงูุนูููุงุช ุงูุดูุฑูุฉ

## โ ุชู ุงูุชูููุฐ ุจูุฌุงุญ!

ุชู ุฅุถุงูุฉ ูุธุงู ูุงูู ููุชูุงูู ูุญุณุงุจ ุงูุนูููุงุช ุงูุดูุฑูุฉ ูุงูุชูุงุฑูุฑ ูููุณุทุงุก ูุงูุฃุฏูู.

---

## ๐ฏ ูุง ุชู ุฅูุฌุงุฒู

### 1. โ Utilities ุฌุฏูุฏุฉ

#### `utils/dateHelper.js` - ูุนุงูุฌุฉ ุงูุชูุงุฑูุฎ
```javascript
- getMonthDateRange()      // ุงูุญุตูู ุนูู ุจุฏุงูุฉ ูููุงูุฉ ุดูุฑ
- getCurrentMonthRange()   // ุงูุดูุฑ ุงูุญุงูู
- getLastNMonths()         // ุขุฎุฑ N ุดูุฑ
- parseMonthString()       // ุชุญููู "2024-03" ูุชูุงุฑูุฎ
- formatMonth()            // ุชูุณูู ุงูุดูุฑ (ุนุฑุจู/ุฅูุฌููุฒู)
```

#### `utils/commissionCalculator.js` - ุญุณุงุจ ุงูุนูููุงุช
```javascript
- calculateMonthlyBrokerCommission()    // ุนูููุฉ ุงููุณูุท ุงูุดูุฑูุฉ
- calculateMonthlyCompanyIncome()       // ุฏุฎู ุงูุดุฑูุฉ ุงูุดูุฑู
- getBrokerCommissionHistory()          // ุณุฌู ุงููุณูุท
- getCompanyIncomeHistory()             // ุณุฌู ุงูุดุฑูุฉ
- compareBrokerMonths()                 // ููุงุฑูุฉ ุงูุดููุฑ
```

---

### 2. โ API Endpoints ุฌุฏูุฏุฉ

ุชู ุฅุถุงูุฉ **9 endpoints ุฌุฏูุฏุฉ** ูู `/api/reports`:

#### ูููุณุทุงุก (Brokers):
```
GET /api/reports/broker/monthly      - ุนูููุฉ ุดูุฑ ูุญุฏุฏ
GET /api/reports/broker/history      - ุณุฌู ุฌููุน ุงูุดููุฑ
GET /api/reports/broker/compare      - ููุงุฑูุฉ ูุน ุงูุดูุฑ ุงูุณุงุจู
```

#### ููุฃุฏูู (Admin):
```
GET /api/reports/company/monthly       - ุฏุฎู ุงูุดุฑูุฉ ุงูุดูุฑู
GET /api/reports/company/history       - ุณุฌู ุฏุฎู ุงูุดุฑูุฉ
GET /api/reports/brokers/performance   - ุฃุฏุงุก ุฌููุน ุงููุณุทุงุก
```

#### ูุดุชุฑู:
```
GET /api/reports/dashboard            - ููุฎุต Dashboard
GET /api/reports/months               - ูุงุฆูุฉ ุงูุฃุดูุฑ ุงููุชุงุญุฉ
GET /api/deals/filter                 - ููุชุฑุฉ ุงูุตููุงุช ุจุงูุชุงุฑูุฎ
```

---

### 3. โ ุงูุชูุซูู ุงูุดุงูู

ุชู ุฅูุดุงุก:
- โ `MONTHLY_REPORTS_API.md` - ุชูุซูู ูุงูู ููู APIs (100+ ุฃูุซูุฉ)
- โ `MONTHLY_COMMISSION_UPDATE.md` - ูุฐุง ุงูููู

---

## ๐จ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### ูููุณุทุงุก:

#### 1. ุงูุนูููุฉ ุงูุดูุฑูุฉ
```javascript
// ูุซุงู: ุนูููุฉ ูุงุฑุณ 2024
GET /api/reports/broker/monthly?year=2024&month=3

Response:
{
  "summary": {
    "totalBrokerShare": 350000,      // ุฅุฌูุงูู ุงูุนูููุฉ
    "approvedCommission": 280000,    // ุงููุนุชูุฏุฉ
    "pendingCommission": 70000,      // ุงููุนููุฉ
    "totalDeals": 15                 // ุนุฏุฏ ุงูุตููุงุช
  }
}
```

#### 2. ุงูุณุฌู ุงูุชุงุฑูุฎู
```javascript
// ุขุฎุฑ 12 ุดูุฑ
GET /api/reports/broker/history?months=12

Response:
{
  "history": [
    { "month": 11, "totalBrokerShare": 350000 },
    { "month": 10, "totalBrokerShare": 300000 },
    { "month": 9, "totalBrokerShare": 280000 }
    // ... ุขุฎุฑ 12 ุดูุฑ
  ]
}
```

#### 3. ุงูููุงุฑูุฉ ุงูุดูุฑูุฉ
```javascript
// ููุงุฑูุฉ ุงูุดูุฑ ุงูุญุงูู ุจุงูุณุงุจู
GET /api/reports/broker/compare

Response:
{
  "change": {
    "deals": +3,              // ุฒูุงุฏุฉ 3 ุตููุงุช
    "commission": +50000,     // ุฒูุงุฏุฉ 50,000
    "commissionPercent": +16.67  // ุฒูุงุฏุฉ 16.67%
  }
}
```

---

### ููุฃุฏูู:

#### 1. ุตุงูู ุงูุฏุฎู ุงูุดูุฑู
```javascript
// ุฏุฎู ูุงุฑุณ 2024
GET /api/reports/company/monthly?year=2024&month=3

Response:
{
  "summary": {
    "totalDeals": 45,
    "totalDealValue": 75000000,
    "totalCommission": 1500000,
    "netIncome": 450000,           // ุตุงูู ุงูุฏุฎู (30%)
    "totalBrokerShare": 1050000    // ูุตูุจ ุงููุณุทุงุก (70%)
  }
}
```

#### 2. ุฃุฏุงุก ุงููุณุทุงุก
```javascript
// ุฃุฏุงุก ุฌููุน ุงููุณุทุงุก
GET /api/reports/brokers/performance?month=11

Response:
{
  "topBrokers": [
    {
      "broker": { "name": "Ahmed Ali" },
      "totalDeals": 15,
      "brokerShare": 350000
    },
    {
      "broker": { "name": "Sara Mohammed" },
      "totalDeals": 12,
      "brokerShare": 300000
    }
  ]
}
```

#### 3. ููุชุฑุฉ ุงูุตููุงุช
```javascript
// ุตููุงุช ุดูุฑ ูุนูู
GET /api/deals/filter?month=2024-03&status=closed

Response:
{
  "deals": [ /* all deals */ ],
  "totals": {
    "totalDeals": 25,
    "totalDealValue": 50000000,
    "totalBrokerShare": 700000,
    "totalCompanyShare": 300000
  }
}
```

---

## ๐ ุงูุจูุงูุงุช ุงููุญุณูุจุฉ

### ููู ูุณูุท ุดูุฑูุงู:
- โ ุฅุฌูุงูู ุงูุตููุงุช
- โ ุฅุฌูุงูู ูููุฉ ุงูุตููุงุช
- โ ุฅุฌูุงูู ุงูุนูููุฉ
- โ ูุตูุจ ุงููุณูุท (70%)
- โ ุงูุนูููุฉ ุงููุนุชูุฏุฉ
- โ ุงูุนูููุฉ ุงููุนููุฉ
- โ ูุชูุณุท ูููุฉ ุงูุตููุฉ
- โ ูุชูุณุท ุงูุนูููุฉ
- โ ุชุตููู ุญุณุจ ุงูุญุงูุฉ (open/closed/cancelled)
- โ ุชุตููู ุญุณุจ ุงูููุน (sale/rent)

### ููุดุฑูุฉ ุดูุฑูุงู:
- โ ุฅุฌูุงูู ุงูุตููุงุช
- โ ุฅุฌูุงูู ูููุฉ ุงูุตููุงุช
- โ ุฅุฌูุงูู ุงูุนูููุงุช
- โ **ุตุงูู ุงูุฏุฎู** (ูุตูุจ ุงูุดุฑูุฉ 30%)
- โ ูุตูุจ ุงููุณุทุงุก (70%)
- โ ูุงูุด ุงูุฑุจุญ
- โ ุฃูุถู 10 ูุณุทุงุก
- โ ุชุตูููุงุช ุชูุตูููุฉ

---

## ๐ ุงูุตูุงุญูุงุช

### ุงููุณูุท (Broker):
- โ ูุฑู ุจูุงูุงุชู ููุท
- โ ูุง ูุณุชุทูุน ุฑุคูุฉ ุจูุงูุงุช ูุณุทุงุก ุขุฎุฑูู
- โ ูุฑู ุตููุงุชู ููุท ูู ุงูููุชุฑุฉ

### ุงูุฃุฏูู (Admin):
- โ ูุฑู ุฌููุน ุงูุจูุงูุงุช
- โ ูุณุชุทูุน ุงูููุชุฑุฉ ุญุณุจ ุงููุณูุท
- โ ูุฑู ุฃุฏุงุก ุฌููุน ุงููุณุทุงุก
- โ ูุญุณุจ ุตุงูู ุฏุฎู ุงูุดุฑูุฉ

---

## ๐ก ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### ุงููุณูุท ูุฑูุฏ ูุนุฑูุฉ ุฑุงุชุจู ุงูุดูุฑู:
```
1. GET /api/reports/broker/monthly
   โ ูุญุตู ุนูู ุฅุฌูุงูู ุนูููุชู

2. GET /api/reports/broker/compare
   โ ููุงุฑู ูุน ุงูุดูุฑ ุงูุณุงุจู

3. GET /api/deals/filter?month=2024-11&status=closed
   โ ูุฑู ุชูุงุตูู ุงูุตููุงุช ุงูููุชููุฉ
```

### ุงูุฃุฏูู ูุฑูุฏ ุญุณุงุจ ุงููุฑุชุจุงุช:
```
1. GET /api/reports/brokers/performance?month=11
   โ ูุญุตู ุนูู ุนูููุงุช ุฌููุน ุงููุณุทุงุก

2. GET /api/reports/company/monthly?month=11
   โ ูุญุตู ุนูู ุตุงูู ุฏุฎู ุงูุดุฑูุฉ

3. GET /api/reports/company/history?months=12
   โ ูุฑุงุฌุน ุณุฌู ุงูุฏุฎู ูุขุฎุฑ ุณูุฉ
```

---

## ๐ ุตูุบ ุงูุชูุงุฑูุฎ

### ุงูุดูุฑ (month):
```
Format: YYYY-MM
Examples: 
  - 2024-03  (ูุงุฑุณ 2024)
  - 2024-11  (ููููุจุฑ 2024)
```

### ูุทุงู ุงูุชุงุฑูุฎ:
```
Format: YYYY-MM-DD
Examples:
  - startDate=2024-03-01
  - endDate=2024-03-31
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูู APIs

### 1. ุงุฎุชุจุฑ ุนูููุฉ ุงููุณูุท:
```bash
curl -X GET "http://localhost:3050/api/reports/broker/monthly?year=2024&month=11" \
  -H "Authorization: Bearer <broker-token>"
```

### 2. ุงุฎุชุจุฑ ุฏุฎู ุงูุดุฑูุฉ:
```bash
curl -X GET "http://localhost:3050/api/reports/company/monthly?year=2024&month=11" \
  -H "Authorization: Bearer <admin-token>"
```

### 3. ุงุฎุชุจุฑ ุงูููุชุฑุฉ:
```bash
curl -X GET "http://localhost:3050/api/deals/filter?month=2024-11" \
  -H "Authorization: Bearer <token>"
```

---

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

```
backend/
โโโ utils/
โ   โโโ dateHelper.js             ๐ ูุนุงูุฌุฉ ุงูุชูุงุฑูุฎ
โ   โโโ commissionCalculator.js   ๐ ุญุณุงุจ ุงูุนูููุงุช
โ
โโโ routes/
โ   โโโ reports.js                ๐ ุชูุงุฑูุฑ ุดูุฑูุฉ
โ   โโโ deals.js                  โ๏ธ ูุญุฏูุซ (ููุชุฑุฉ ุจุงูุชุงุฑูุฎ)
โ
โโโ start-server.js               โ๏ธ ูุญุฏูุซ (ุฃุถูู /api/reports)
โ
โโโ [ุชูุซูู]
    โโโ MONTHLY_REPORTS_API.md    ๐ ุชูุซูู ุดุงูู
    โโโ MONTHLY_COMMISSION_UPDATE.md ๐ ูุฐุง ุงูููู
```

---

## โ Checklist ุงูุชูููุฐ

- [x] ุฅูุดุงุก dateHelper.js
- [x] ุฅูุดุงุก commissionCalculator.js
- [x] ุฅูุดุงุก routes/reports.js
- [x] ุชุญุฏูุซ routes/deals.js (ููุชุฑุฉ)
- [x] ุชุญุฏูุซ start-server.js
- [x] ุฅูุดุงุก ุชูุซูู ุดุงูู
- [x] ุฃูุซูุฉ ุนูููุฉ
- [x] ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุดุบูู ุงูุณูุฑูุฑ:
```bash
npm run dev
```

### 2. ุงุฎุชุจุฑ ุงูู APIs:
```bash
# ูููุณูุท
GET http://localhost:3050/api/reports/broker/monthly

# ููุฃุฏูู
GET http://localhost:3050/api/reports/company/monthly
```

### 3. ุฑุงุฌุน ุงูุชูุซูู:
```bash
# ุงูุชุญ
MONTHLY_REPORTS_API.md
```

---

## ๐ ูุซุงู ุนููู ูุงูู

### ุณููุงุฑูู: ุฃุฏูู ูุฑูุฏ ุญุณุงุจ ุงููุฑุชุจุงุช ูุดูุฑ ููููุจุฑ

#### ุงูุฎุทูุฉ 1: ุฌูุจ ุฃุฏุงุก ุฌููุน ุงููุณุทุงุก
```javascript
GET /api/reports/brokers/performance?year=2024&month=11

Response:
{
  "topBrokers": [
    { "broker": {"name": "Ahmed"}, "brokerShare": 350000 },
    { "broker": {"name": "Sara"}, "brokerShare": 300000 },
    { "broker": {"name": "Mohammed"}, "brokerShare": 250000 }
  ]
}
```

#### ุงูุฎุทูุฉ 2: ุชูุงุตูู ูู ูุณูุท
```javascript
GET /api/reports/broker/monthly?brokerId=5&year=2024&month=11

Response:
{
  "summary": {
    "totalBrokerShare": 350000,      // ุงูุฑุงุชุจ
    "approvedCommission": 280000,    // ุงููุนุชูุฏ
    "pendingCommission": 70000       // ูุนูู
  }
}
```

#### ุงูุฎุทูุฉ 3: ุตุงูู ุฏุฎู ุงูุดุฑูุฉ
```javascript
GET /api/reports/company/monthly?year=2024&month=11

Response:
{
  "summary": {
    "netIncome": 450000,           // ุฏุฎู ุงูุดุฑูุฉ
    "totalBrokerShare": 1050000,   // ุฅุฌูุงูู ุฑูุงุชุจ ุงููุณุทุงุก
    "totalDealValue": 75000000     // ุฅุฌูุงูู ุงูุตููุงุช
  }
}
```

**ุงููุชูุฌุฉ:**
- ุฅุฌูุงูู ุฑูุงุชุจ ุงููุณุทุงุก: **1,050,000 ุฏุฑูู**
- ุตุงูู ุฏุฎู ุงูุดุฑูุฉ: **450,000 ุฏุฑูู**
- ุฅุฌูุงูู ุงูุนูููุงุช: **1,500,000 ุฏุฑูู**

---

## ๐ ุงูุฎูุงุตุฉ

### ุชู ุจูุฌุงุญ:
- โ ูุธุงู ูุงูู ูุญุณุงุจ ุงูุนูููุงุช ุงูุดูุฑูุฉ
- โ ุชูุงุฑูุฑ ุดุงููุฉ ูููุณุทุงุก ูุงูุฃุฏูู
- โ ููุชุฑุฉ ูุชูุฏูุฉ ุจุงูุชุงุฑูุฎ
- โ ุณุฌู ุชุงุฑูุฎู ูุฌููุน ุงูุดููุฑ
- โ ููุงุฑูุฉ ุดูุฑูุฉ
- โ Dashboard summary
- โ ุชูุซูู ุดุงูู ูุน ุฃูุซูุฉ

### ุงูููุงุฆุฏ:
- ๐ฐ ุญุณุงุจ ุฏููู ููุฑูุงุชุจ ูุงูุนูููุงุช
- ๐ ุชูุงุฑูุฑ ุชูุตูููุฉ ูุดุงููุฉ
- ๐ ููุชุฑุฉ ูููุฉ ููุฑูุฉ
- ๐ ุชุชุจุน ุงูุฃุฏุงุก ุดูุฑูุงู
- โก ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ
- ๐ ุตูุงุญูุงุช ูุญููุฉ

---

## ๐ ุงูุฏุนู

ููุฃุณุฆูุฉ ุฃู ุงููุณุงุนุฏุฉ:
- ๐ ุฑุงุฌุน `MONTHLY_REPORTS_API.md`
- ๐ง Email: dev@alrabei.com

---

**ุชู ุงูุชุญุฏูุซ:** ููููุจุฑ 2024  
**ุงูุฅุตุฏุงุฑ:** 1.2.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู

---

<div align="center">

# โ ูุธุงู ุงูุนูููุงุช ุงูุดูุฑูุฉ ุฌุงูุฒ!

**ุฌููุน ุงููุชุทูุจุงุช ูููุฐุฉ ุจูุฌุงุญ** ๐

</div>

